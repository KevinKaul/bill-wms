# 组合产品导入功能 - 快速启动指南

## 🚀 快速开始

### 第一步：准备测试原材料

在产品管理页面创建以下测试原材料：

```
1. SKU: RM001, 名称: 原材料A, 参考采购价: 15.50
2. SKU: RM002, 名称: 原材料B, 参考采购价: 22.00
3. SKU: RM003, 名称: 原材料C, 参考采购价: 18.75
```

或者使用SQL直接插入：

```sql
INSERT INTO products (id, sku, name, type, referencePurchasePrice, status, createdAt, updatedAt)
VALUES
  (UUID(), 'RM001', '原材料A', 'RAW_MATERIAL', 15.50, 'active', NOW(), NOW()),
  (UUID(), 'RM002', '原材料B', 'RAW_MATERIAL', 22.00, 'active', NOW(), NOW()),
  (UUID(), 'RM003', '原材料C', 'RAW_MATERIAL', 18.75, 'active', NOW(), NOW());
```

### 第二步：下载模板

1. 访问产品管理页面：`/dashboard/product`
2. 点击右上角的"导入产品"按钮
3. 切换到"导入组合产品"选项卡
4. 点击"下载模板"按钮
5. 保存文件：`组合产品导入模板.xlsx`

### 第三步：填写模板

打开下载的模板文件，你会看到：
- **花环-FP001**：示例Sheet 1
- **装饰品-FP002**：示例Sheet 2
- **导入说明**：详细说明

#### 修改示例数据或创建新Sheet：

**方式A：修改现有Sheet**
1. 打开"花环-FP001" Sheet
2. 修改第2行的产品信息：
   - SKU: FP001
   - 产品名称: 测试花环
   - 产品描述: 这是我的第一个组合产品
3. 修改BOM数据（从第5行开始）：
   - RM001 × 10
   - RM002 × 5
   - RM003 × 8

**方式B：创建新Sheet**
1. 右键点击Sheet标签 → 插入 → 工作表
2. 重命名为"我的产品-FP999"
3. 复制"花环-FP001"的表头结构
4. 填写你的产品数据

#### 添加产品图片（可选）：
1. 选中第一列第2行的单元格（A2）
2. 插入 → 图片 → 选择图片文件
3. 调整图片大小适应单元格

### 第四步：上传导入

1. 回到产品管理页面
2. 点击"导入产品"按钮
3. 切换到"导入组合产品"选项卡
4. 点击"选择文件"按钮
5. 选择你填写好的Excel文件
6. 等待上传和处理（会显示进度条）

### 第五步：查看结果

#### 成功导入
```
✅ 导入成功！已导入 1 个产品
```

点击"完成"按钮，在产品列表中查看新导入的产品。

#### 部分失败
```
⚠️ 导入完成：成功 1 个，失败 1 个

错误详情：
第 2 行：SKU "FP001" 已存在，跳过此产品
```

修正错误后可以重新导入。

### 第六步：验证产品

1. 在产品列表中找到导入的产品（FP001）
2. 点击产品名称进入详情页
3. 验证以下信息：
   - ✅ 产品类型：组合产品
   - ✅ 指导单价：¥415.00（自动计算）
   - ✅ BOM构成：3个原材料
   - ✅ 产品图片（如果上传了）

## 📊 预期结果

### 产品信息
```
SKU: FP001
名称: 测试花环
类型: 组合产品
状态: 活跃
指导单价: ¥415.00
```

### BOM构成
```
1. 原材料A (RM001) × 10 = ¥155.00
2. 原材料B (RM002) × 5  = ¥110.00
3. 原材料C (RM003) × 8  = ¥150.00
-------------------------------------------
总计:                      ¥415.00
```

## 🔍 常见问题排查

### 问题1：下载模板时404错误
**原因**：模板文件不存在
**解决**：运行模板生成脚本
```bash
node scripts/create-finished-product-template.js
```

### 问题2：原材料SKU不存在
**错误信息**：`以下原材料SKU不存在或不是原材料类型: RM001`
**解决**：
1. 检查原材料是否已创建
2. 检查SKU拼写是否正确（区分大小写）
3. 确认产品类型为"原材料"

### 问题3：SKU重复
**错误信息**：`SKU "FP001" 已存在，跳过此产品`
**解决**：
1. 修改Excel中的SKU为新的值（如FP002）
2. 或删除系统中已存在的产品

### 问题4：BOM数量无效
**错误信息**：`BOM数量必须为正数`
**解决**：
1. 检查数量列是否为数字
2. 确保数量大于0
3. 不要使用文本或负数

### 问题5：上传失败
**错误信息**：`组合产品导入仅支持Excel文件`
**解决**：
1. 确保文件格式为.xlsx或.xls
2. 不要使用CSV格式
3. 确保文件没有损坏

## 🎯 批量导入示例

### 导入3个产品

创建包含3个Sheet的Excel文件：

**Sheet 1: 花环-FP001**
```
产品: FP001, 精美花环
BOM: RM001×10, RM002×5, RM003×8
```

**Sheet 2: 装饰品-FP002**
```
产品: FP002, 节日装饰品
BOM: RM001×15, RM003×3
```

**Sheet 3: 摆件-FP003**
```
产品: FP003, 桌面摆件
BOM: RM002×8, RM003×12
```

上传后结果：
```
✅ 导入成功！已导入 3 个产品
```

## 📝 Excel模板结构速查

```
┌─────────────────────────────────────────────────────┐
│ Sheet名称: 花环-FP001                               │
├─────────────────────────────────────────────────────┤
│ 第1行（表头）：                                     │
│ ┌──────────┬───────┬────────────┬──────────────┐   │
│ │ 封面图片 │ SKU   │ 产品名称   │ 产品描述     │   │
│ └──────────┴───────┴────────────┴──────────────┘   │
│                                                     │
│ 第2行（数据）：                                     │
│ ┌──────────┬───────┬────────────┬──────────────┐   │
│ │ [图片]   │ FP001 │ 精美花环   │ 产品描述文字 │   │
│ └──────────┴───────┴────────────┴──────────────┘   │
│                                                     │
│ 第3行：空行                                         │
│                                                     │
│ 第4行（BOM表头）：                                  │
│ ┌─────────────┬────────────┐                       │
│ │ 原材料SKU   │ 需要数量   │                       │
│ └─────────────┴────────────┘                       │
│                                                     │
│ 第5行开始（BOM数据）：                              │
│ ┌─────────────┬────────────┐                       │
│ │ RM001       │ 10         │                       │
│ │ RM002       │ 5          │                       │
│ │ RM003       │ 8          │                       │
│ └─────────────┴────────────┘                       │
└─────────────────────────────────────────────────────┘
```

## ✅ 功能检查清单

导入前检查：
- [ ] 已创建测试原材料（RM001、RM002、RM003）
- [ ] 已下载导入模板
- [ ] 已填写产品信息
- [ ] 已填写BOM数据
- [ ] SKU没有重复
- [ ] 原材料SKU正确

导入后验证：
- [ ] 产品成功创建
- [ ] 产品类型为"组合产品"
- [ ] BOM关系正确建立
- [ ] 指导单价正确计算
- [ ] 产品图片正确显示（如果上传了）

## 🎉 成功标志

如果你看到以下内容，说明功能运行正常：

1. ✅ 能够下载模板
2. ✅ 能够上传Excel文件
3. ✅ 显示导入成功消息
4. ✅ 产品列表中出现新产品
5. ✅ 产品详情显示完整信息
6. ✅ BOM构成正确关联
7. ✅ 指导单价自动计算

恭喜！组合产品导入功能已经可以正常使用了！🎊

## 📚 更多信息

- 详细功能文档：`/docs/FINISHED_PRODUCT_IMPORT.md`
- 测试计划：`/docs/FINISHED_PRODUCT_IMPORT_TEST.md`
- 功能总结：`/FINISHED_PRODUCT_IMPORT_FEATURE.md`
